# Generated by Jinja2 for OpenTofu/Terraform deployment
# Based on YAML manifest structure (see infrastructure-manifest.yaml)
# This file is auto-generated. Do not edit manually.

images = {
{% for key, img in images.items() %}
  {{ key }} = {
    target_node              = "{{ img.target_node }}"
    target_datastore         = "{{ img.target_datastore }}"
    image_type               = "{{ img.image_type }}"
    image_filename           = "{{ img.image_filename }}"
    image_url                = "{{ img.image_url }}"
    image_checksum           = "{{ img.image_checksum }}"
    image_checksum_algorithm = "{{ img.image_checksum_algorithm }}"
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

vm_templates = {
{% for key, tmpl in vm_templates.items() %}
  {{ key }} = {
    target_node          = "{{ tmpl.target_node }}"
    target_datastore     = "{{ tmpl.target_datastore }}"
    vm_id                = {{ tmpl.vm_id }}
    description          = "{{ tmpl.description }}"
    tags                 = [{% for tag in tmpl.tags %}"{{ tag }}"{% if not loop.last %}, {% endif %}{% endfor %}]
    image_id             = "{{ tmpl.image_id }}"
    os_type              = "{{ tmpl.os_type }}"
{% if tmpl.bios is defined and tmpl.bios %}
    bios                 = "{{ tmpl.bios }}"
{% endif %}
{% if tmpl.machine_type is defined %}
    machine_type         = {{ '"%s"' % tmpl.machine_type if tmpl.machine_type else 'null' }}
{% endif %}
{% if tmpl.enable_tpm is defined %}
    enable_tpm           = {{ tmpl.enable_tpm | lower }}
{% endif %}
{% if tmpl.secure_boot is defined %}
    secure_boot          = {{ tmpl.secure_boot | lower }}
{% endif %}
    memory               = {{ tmpl.memory }}
    cores                = {{ tmpl.cores }}
    disk_size            = {{ tmpl.disk_size }}
    vnic_bridge          = "{{ tmpl.vnic_bridge }}"
    ci_user_data_id      = {{ '"%s"' % tmpl.ci_user_data_id if tmpl.ci_user_data_id else 'null' }}
    ci_vendor_data_id    = {{ '"%s"' % tmpl.ci_vendor_data_id if tmpl.ci_vendor_data_id else 'null' }}
    ci_network_data_id   = {{ '"%s"' % tmpl.ci_network_data_id if tmpl.ci_network_data_id else 'null' }}
    ci_meta_data_id      = {{ '"%s"' % tmpl.ci_meta_data_id if tmpl.ci_meta_data_id else 'null' }}
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

container_templates = {
{% for key, ct in container_templates.items() %}
  {{ key }} = {
    target_node      = "{{ ct.target_node }}"
    target_datastore = "{{ ct.target_datastore }}"
    lxc_id           = {{ ct.lxc_id }}
    description      = "{{ ct.description }}"
    tags             = [{% for tag in ct.tags %}"{{ tag }}"{% if not loop.last %}, {% endif %}{% endfor %}]
    image_id         = "{{ ct.image_id }}"
    os_type          = "{{ ct.os_type }}"
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

virtual_machines = {
{% for key, vm in virtual_machines.items() %}
  {{ key }} = {
    template_id    = "{{ vm.template_id }}"
    target_node    = "{{ vm.target_node }}"
{% if vm.is_batch %}
    count          = {{ vm.count }}
    vm_id_start    = {{ vm.vm_id_start }}
{% if vm.wait_for_agent is defined %}
    wait_for_agent = {{ vm.wait_for_agent | lower }}
{% endif %}
{% if vm.disks is defined %}
    disks = [
{% for disk in vm.disks %}
      {
{% if 'disk_datastore' in disk %}
        disk_datastore = "{{ disk.disk_datastore }}"
{% endif %}
{% if 'disk_interface' in disk %}
        disk_interface = "{{ disk.disk_interface }}"
{% endif %}
{% if 'disk_size' in disk %}
        disk_size      = {{ disk.disk_size }}
{% endif %}
{% if 'disk_format' in disk %}
        disk_format    = "{{ disk.disk_format }}"
{% endif %}
{% if 'disk_cache' in disk %}
        disk_cache     = "{{ disk.disk_cache }}"
{% endif %}
{% if 'disk_iothread' in disk %}
        disk_iothread  = {{ "true" if disk.disk_iothread else "false" }}
{% endif %}
{% if 'disk_ssd' in disk %}
        disk_ssd       = {{ "true" if disk.disk_ssd else "false" }}
{% endif %}
{% if 'disk_discard' in disk %}
        disk_discard   = "{{ disk.disk_discard }}"
{% endif %}
      }{{ "," if not loop.last else "" }}
{% endfor %}
    ]
{% endif %}
{% else %}
{% if vm.vm_id is defined %}
    vm_id          = {{ vm.vm_id }}
{% endif %}
{% if vm.wait_for_agent is defined %}
    wait_for_agent = {{ vm.wait_for_agent | lower }}
{% endif %}
{% endif %}
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

containers = {
{% for key, ct in containers.items() %}
  {{ key }} = {
    template_id      = "{{ ct.template_id }}"
    target_node      = "{{ ct.target_node }}"
    target_datastore = "{{ ct.target_datastore }}"
{% if ct.is_batch %}
    count            = {{ ct.count }}
    lxc_id_start     = {{ ct.lxc_id_start }}
{% else %}
    lxc_id           = {{ ct.lxc_id }}
{% endif %}
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

ci_user_configs = {
{% for key, cfg in ci_user_configs.items() %}
  {{ key }} = {
    target_node      = "{{ cfg.target_node }}"
    target_datastore = "{{ cfg.target_datastore }}"
    username         = "{{ cfg.username }}"
    ssh_public_key   = "{{ cfg.ssh_public_key }}"
    set_password     = {{ cfg.set_password | lower }}
    password         = "{{ cfg.password }}"
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

ci_vendor_configs = {
{% for key, cfg in ci_vendor_configs.items() %}
  {{ key }} = {
    target_node      = "{{ cfg.target_node }}"
    target_datastore = "{{ cfg.target_datastore }}"
    packages         = [{% for pkg in cfg.packages %}"{{ pkg }}"{% if not loop.last %}, {% endif %}{% endfor %}]
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

ci_network_configs = {
{% for key, cfg in ci_network_configs.items() %}
  {{ key }} = {
    target_node       = "{{ cfg.target_node }}"
    target_datastore  = "{{ cfg.target_datastore }}"
    interface_name    = "{{ cfg.interface_name }}"
    dhcp4             = {{ cfg.dhcp4 | lower }}
    dhcp6             = {{ cfg.dhcp6 | lower }}
    accept_ra         = {{ cfg.accept_ra | lower }}
    dns_search_domain = [{% for domain in cfg.dns_search_domain %}"{{ domain }}"{% if not loop.last %}, {% endif %}{% endfor %}]
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

ci_meta_configs = {
{% for key, cfg in ci_meta_configs.items() %}
  {{ key }} = {
    target_node      = "{{ cfg.target_node }}"
    target_datastore = "{{ cfg.target_datastore }}"
    hostname         = "{{ cfg.hostname }}"
  }
{% if not loop.last %}

{% endif %}
{% endfor %}
}

talos_cluster_name = "{{ talos_config.cluster_name }}"
talos_version      = "{{ talos_config.talos_version }}"
kubernetes_version = "{{ talos_config.kubernetes_version }}"
