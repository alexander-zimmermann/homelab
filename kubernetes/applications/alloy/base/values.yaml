cluster:
  name: homelab

global:
  scrapeInterval: 60s

# Remote write / push endpoints for metrics and logs.
destinations:
  - name: prometheus
    type: prometheus
    url: http://prometheus-operated.prometheus:9090/api/v1/write
  - name: loki
    type: loki
    url: http://loki-gateway.loki.svc.cluster.local/loki/api/v1/push
    header:
      batchSize: 256KiB
      batchWait: 1s

# Cluster metrics & events
clusterMetrics:
  enabled: true
  destinations:
    - prometheus

clusterEvents:
  enabled: true
  destinations:
    - loki

# Node & pod logs
nodeLogs:
  enabled: true
  destinations:
    - loki

podLogs:
  enabled: true
  # Use the stable volumes-based pod log collection (renders `loki.source.file "pod_logs"`)
  gatherMethod: volumes
  # Start reading at the end of existing log files (no backfill); only new lines after Alloy starts are shipped
  volumeGatherSettings:
    onlyGatherNewLogLines: true
  destinations:
    - loki

# Alloy Metrics: Cluster metrics & events
alloy-metrics:
  enabled: true
  # Expose Alloy Metrics service via Cilium/BGP-announced LoadBalancer
  service:
    type: LoadBalancer
    labels:
      bgp.cilium.io/ip-pool: default
      bgp.cilium.io/advertise-service: default

# Alloy Singleton: Per-cluster tasks like event processing
alloy-singleton:
  enabled: true

# Alloy Logs: Collects and forwards logs to Loki
alloy-logs:
  enabled: true
