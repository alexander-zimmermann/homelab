rbac:
  # Allows Grafana to retrieve metadata about services and pods for service discovery
  extraClusterRoleRules:
    - apiGroups: [""]
      resources: ["services", "endpoints", "pods"]
      verbs: ["get", "list", "watch"]

serviceAccount:
  # Explicit name for the ServiceAccount for better traceability
  name: grafana

podLabels:
  # Additional label for consistent selectors in services and network policies
  component: grafana-server

admin:
  # Reference to a SealedSecret containing the username and password for admin access
  existingSecret: "grafana-admin-credentials"
  userKey: admin-user
  passwordKey: admin-password

extraSecretMounts:
  # Mount the admin credentials secret into the container for grafana.ini access
  - name: grafana-admin-credentials
    secretName: grafana-admin-credentials
    defaultMode: 0440
    mountPath: /etc/grafana/secrets
    readOnly: true

# Primary Configuration (grafana.ini)
grafana.ini:
  security:
    admin_user: admin
    admin_password_file: /etc/grafana/secrets/admin-password

# Sidecar Configuration (Auto-import)
sidecar:
  dashboards:
    enabled: true
    searchNamespace: ALL
  datasources:
    enabled: true
    searchNamespace: ALL

# Image Rendering (PNG Exports)
imageRenderer:
  enabled: true
  networkPolicy:
    limitIngress: false

extraObjects:
  # Register the Grafana instance with the Grafana Operator for advanced management
  - apiVersion: grafana.integreatly.org/v1beta1
    kind: Grafana
    metadata:
      name: grafana
    spec:
      external:
        url: "http://grafana.grafana-instance.svc.cluster.local:80"
        adminUser:
          name: grafana-admin-credentials
          key: admin-user
        adminPassword:
          name: grafana-admin-credentials
          key: admin-password
