# RBAC & Permissions
rbac:
  # Allows Grafana to retrieve metadata about services and pods for service discovery
  extraClusterRoleRules:
    - apiGroups: [""]
      resources: ["services", "endpoints", "pods"]
      verbs: ["get", "list", "watch"]

# Service Account
serviceAccount:
  # Explicit name for the ServiceAccount for better traceability
  name: grafana

# Pod Metadata
podLabels:
  # Additional label for consistent selectors in services and network policies
  component: grafana-server

## Resources
# Container resources: requests influence scheduling/QoS; limits enforce a hard cap.
resources:
  # Resources for the main Grafana container.
  requests:
    cpu: 50m
    memory: 256Mi
  limits:
    cpu: 1000m
    memory: 1Gi

# Administrator Access
admin:
  # Reference to a SealedSecret containing the username and password
  existingSecret: "grafana-admin-credentials"
  userKey: admin-user
  passwordKey: admin-password

# Secret Mounts
extraSecretMounts:
  # Mount the admin credentials secret into the container for grafana.ini access
  - name: grafana-admin-credentials
    secretName: grafana-admin-credentials
    defaultMode: 0440
    mountPath: /etc/grafana/secrets
    readOnly: true

# Primary Configuration (grafana.ini)
grafana.ini:
  security:
    admin_user: admin
    admin_password_file: /etc/grafana/secrets/admin-password

# Sidecar Configuration (Auto-import)
sidecar:
  # Resources for the sidecar containers (dashboards/datasources, etc.).
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 128Mi
  dashboards:
    enabled: true
    searchNamespace: ALL
  datasources:
    enabled: true
    searchNamespace: ALL

# Image Rendering (PNG Exports)
imageRenderer:
  enabled: true
  # Resources for the image renderer Deployment.
  resources:
    requests:
      cpu: 20m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  networkPolicy:
    limitIngress: false

extraObjects:
  # Register the Grafana instance with the Grafana Operator for advanced management
  - apiVersion: grafana.integreatly.org/v1beta1
    kind: Grafana
    metadata:
      name: grafana
    spec:
      external:
        url: "http://grafana.grafana-instance.svc.cluster.local:80"
        adminUser:
          name: grafana-admin-credentials
          key: admin-user
        adminPassword:
          name: grafana-admin-credentials
          key: admin-password
