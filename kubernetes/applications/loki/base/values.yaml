# Loki SingleBinary deployment
deploymentMode: SingleBinary

singleBinary:
  replicas: 1
  persistence:
    # Automatic StatefulSet recreation for PVC expansion
    enableStatefulSetRecreationForSizeChange: true
    # Persistent Volume Claim storage size
    size: 5Gi
    storageClass: longhorn

# Scalability settings for distributed components
write:
  replicas: 0
read:
  replicas: 0
backend:
  replicas: 0

loki:
  # Disable internal authentication
  auth_enabled: false

  commonConfig:
    # Ingester replication factor
    replication_factor: 1

  ingester:
    # Max time a chunk lives in memory before flushing
    max_chunk_age: 1h
    # Flush chunk after this idle period
    chunk_idle_period: 30m
    # Target chunk size in bytes (1MB)
    chunk_target_size: 1048576
    # Compression algorithm
    chunk_encoding: snappy

  querier:
    # Max concurrent queries per querier
    max_concurrent: 2

  limits_config:
    # Global log retention period
    retention_period: 168h
    # Maximum lookback period for log queries
    max_query_lookback: 168h
    # Rejection threshold for older log samples
    reject_old_samples: true
    reject_old_samples_max_age: 168h

    # Max sub-queries per request (split by time)
    max_query_parallelism: 4
    # Max parallelism for TSDB index queries
    tsdb_max_query_parallelism: 32
    # Limit log lines returned per query to prevent OOM
    max_entries_limit_per_query: 5000
    # Hard timeout for queries
    query_timeout: 30s

  storage:
    type: filesystem

  schemaConfig:
    # Schema configuration for storage
    configs:
      - from: "2024-04-01"
        # Store for index: TSDB is the modern, efficient format for Loki
        store: tsdb
        # Store for chunks: filesystem (local disk via PVC)
        object_store: filesystem
        # Schema version: v13 is recommended for TSDB
        schema: v13
        index:
          prefix: index_
          period: 24h

  compactor:
    # Compactor-based retention configuration
    retention_enabled: true
    delete_request_store: filesystem

# Chunks cache resources are configured in overlays
chunksCache:
  allocatedMemory: 256

# Results cache resources are configured in overlays
resultsCache:
  allocatedMemory: 256
