# Loki configuration overrides for SingleBinary deployment
deploymentMode: SingleBinary

loki:
  # Internal authentication toggle
  auth_enabled: false

  limits_config:
    # Global log retention period
    retention_period: 168h
    # Maximum lookback period for log queries
    max_query_lookback: 168h
    # Rejection threshold for older log samples
    reject_old_samples: true
    reject_old_samples_max_age: 168h

  commonConfig:
    # Ingester replication factor
    replication_factor: 1

  storage:
    type: filesystem

  schemaConfig:
    configs:
      - from: "2024-04-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: index_
          period: 24h

  compactor:
    # Compactor-based retention configuration
    retention_enabled: true
    delete_request_store: filesystem

# Scalability settings for distributed components
write:
  replicas: 0
read:
  replicas: 0
backend:
  replicas: 0

# Chunks cache resources: requests influence scheduling/QoS; limits enforce a hard cap.
chunksCache:
  allocatedMemory: 256
  resources:
    requests:
      cpu: 50m
      memory: 307Mi
    limits:
      cpu: 200m
      memory: 307Mi

# Results cache resources: requests influence scheduling/QoS; limits enforce a hard cap.
resultsCache:
  allocatedMemory: 256
  resources:
    requests:
      cpu: 50m
      memory: 307Mi
    limits:
      cpu: 200m
      memory: 307Mi

# Memcached exporter resources: requests influence scheduling/QoS; limits enforce a hard cap.
memcachedExporter:
  resources:
    requests:
      cpu: 5m
      memory: 16Mi
    limits:
      cpu: 50m
      memory: 64Mi

# Gateway resources: requests influence scheduling/QoS; limits enforce a hard cap.
gateway:
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 128Mi

# Loki canary resources: requests influence scheduling/QoS; limits enforce a hard cap.
lokiCanary:
  resources:
    requests:
      cpu: 5m
      memory: 16Mi
    limits:
      cpu: 50m
      memory: 64Mi

# Persistence configuration for SingleBinary mode
singleBinary:
  replicas: 1
  # Loki single-binary resources: requests influence scheduling/QoS; limits enforce a hard cap.
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  persistence:
    # Automatic StatefulSet recreation for PVC expansion
    enableStatefulSetRecreationForSizeChange: true
    # Persistent Volume Claim storage size
    size: 5Gi
    storageClass: longhorn

# Rules sidecar resources: requests influence scheduling/QoS; limits enforce a hard cap.
sidecar:
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 128Mi
