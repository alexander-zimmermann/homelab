# Use a stable, short name for all rendered resources
fullnameOverride: prometheus

# Reduce duplicate prefixes for objects created by the Prometheus Operator
cleanPrometheusOperatorObjectNames: true

# Grafana runs as a separate app
grafana:
  enabled: false

# Disable exporters/components that are provided elsewhere
kubeStateMetrics:
  enabled: false

nodeExporter:
  enabled: false

alertmanager:
  alertmanagerSpec:
    # Persist Alertmanager state
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: longhorn
          accessModes:
            - ReadWriteOnce

prometheus:
  prometheusSpec:
    # Required for remote_write receiver (e.g. for agent-based ingestion)
    enableRemoteWriteReceiver: true

    # Reduces TSDB disk usage by approx. 30-40% with minimal CPU overhead
    walCompression: true

    # Stability guards to prevent OOM kills from heavy queries or dashboards
    additionalArgs:
      - name: query.max-concurrency
        value: "5"
      - name: query.timeout
        value: "30s"
      - name: query.max-samples
        value: "5000000"

    # Persist TSDB data
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: longhorn
          accessModes:
            - ReadWriteOnce
