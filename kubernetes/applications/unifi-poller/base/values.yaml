# Add Prometheus scrape hints (also works without ServiceMonitor).
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9130"

# Enable PodMonitor (Prometheus Operator) instead of ServiceMonitor.
podMonitor:
  enabled: true

# Keep ServiceMonitor explicitly off (we rely on PodMonitor).
serviceMonitor:
  enabled: false

# Expose the metrics port inside the cluster.
service:
  enabled: true
  type: ClusterIP
  port: 9130

# Use Grafana Operator dashboards, but target an existing Grafana instance.
dashboards:
  grafana:
    create: false
    selectorLabels:
      homelab.app: grafana-instance

# Unifi-poller resources: requests influence scheduling/QoS; limits enforce a hard cap.
resources:
  requests:
    cpu: 10m
    memory: 32Mi
  limits:
    cpu: 200m
    memory: 128Mi

# Unpoller configuration.
# Secrets are referenced via file path inside the container.
upConfig: |
  [poller]
    debug = false
    quiet = false
    plugins = []
  [prometheus]
    disable = false
    http_listen = "0.0.0.0:9130"
    report_errors = false
  [influxdb]
    disable = true
  [loki]
    disable = false
    url = "http://loki-gateway.loki.svc:80"
    verify_ssl = false
  [datadog]
    disable = true
  [webserver]
    enable = false
  [unifi]
    dynamic = false
  [[unifi.controller]]
    url = "https://udm-pro.zimmermann.eu.com"
    user = "unifi-poller"
    pass = "file:///etc/unifi-poller/secrets/unifi-password"
    sites = ["all"]
    save_ids = false
    save_events = false
    save_alarms = false
    save_anomalies = false
    save_dpi = false
    save_rogue = false
    verify_ssl = false

# Mount credentials secret into the container.
extraVolumes:
  - name: unifi-creds
    secret:
      secretName: unpoller-unifi-credentials

extraVolumeMounts:
  - name: unifi-creds
    mountPath: /etc/unifi-poller/secrets
    readOnly: true
