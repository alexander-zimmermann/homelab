---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base

patches:
  # Patch for 'applications' (Business Apps) - uses File Generator + Base
  - patch: |-
      - op: replace
        path: /spec/template/spec/source/path
        value: kubernetes/applications/{{index .path.segments 2}}/overlays/dev
    target:
      kind: ApplicationSet
      name: applications

  # Patch for 'cluster' (Infra Components) - uses File Generator + Base
  - patch: |-
      - op: replace
        path: /spec/template/spec/source/path
        value: kubernetes/components/{{index .path.segments 2}}/overlays/dev
    target:
      kind: ApplicationSet
      name: cluster
