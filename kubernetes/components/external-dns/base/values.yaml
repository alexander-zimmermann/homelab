# Use a stable, short name for all rendered resources
fullnameOverride: external-dns

global:
  # Required for pulling images from the private DHI registry
  imagePullSecrets:
    - name: dhi-registry-secret

# Cloudflare as DNS provider
provider:
  name: cloudflare

# Cloudflare API Token (mounted from SealedSecret)
env:
  - name: CF_API_TOKEN
    valueFrom:
      secretKeyRef:
        name: external-dns-cf-credentials
        key: cf-api-token

# Ensure Cloudflare proxies new records
extraArgs:
  - --cloudflare-proxied

# Unique identifier for this cluster's records
txtOwnerId: homelab

# Domains managed by this instance
domainFilters:
  - zimmermann.sh
  - zimmermann.eu.com
  - zimmermann.phd

# Watch these resources for DNS annotations
sources:
  - service
  - ingress
  - traefik-proxy

# Required permissions for Traefik IngressRoute and other resources
rbac:
  create: true
  additionalPermissions:
    - apiGroups: [""]
      resources: ["services", "pods"]
      verbs: ["get", "watch", "list"]
    - apiGroups: ["discovery.k8s.io"]
      resources: ["endpointslices"]
      verbs: ["get", "watch", "list"]
    - apiGroups: [""]
      resources: ["nodes"]
      verbs: ["list", "watch"]
    - apiGroups: ["traefik.io", "traefik.containo.us"]
      resources: ["ingressroutes", "ingressroutetcps", "ingressrouteudps"]
      verbs: ["get", "watch", "list"]

# Prometheus Metrics (Opt-In)
serviceMonitor:
  enabled: true
  labels:
    release: prometheus
